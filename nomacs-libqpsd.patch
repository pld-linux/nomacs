--- nomacs-3.4.1/cmake/Findqpsd.cmake.orig	1970-01-01 01:00:00.000000000 +0100
+++ nomacs-3.4.1/cmake/Findqpsd.cmake	2016-09-10 21:25:00.580715267 +0200
@@ -0,0 +1,16 @@
+# QPSD_FOUND - system has the LIBQPSD library
+# LIBQPSD_INCLUDE_DIRECTORY - the LIBQPSD include directory
+# LIBQPSD_LIBRARY - The libraries needed to use LIBQPSD
+
+if(LIBQPSD_INCLUDE_DIRECTORY AND LIBQPSD_LIBRARY)
+	set(QPSD_FOUND TRUE)
+else()
+	find_path(LIBQPSD_INCLUDE_DIRECTORY NAMES qpsdhandler.h PATH_SUFFIXES qt5)
+	
+	find_library(LIBQPSD_LIBRARY NAMES qpsd5)
+	
+	include(FindPackageHandleStandardArgs)
+	find_package_handle_standard_args(QPSD DEFAULT_MSG LIBQPSD_INCLUDE_DIRECTORY LIBQPSD_LIBRARY)
+	
+	mark_as_advanced(LIBQPSD_INCLUDE_DIRECTORY LIBQPSD_LIBRARY)
+endif(LIBQPSD_INCLUDE_DIRECTORY AND LIBQPSD_LIBRARY)
--- nomacs-3.4.1/CMakeLists.txt.orig	2016-09-10 21:27:15.454047058 +0200
+++ nomacs-3.4.1/CMakeLists.txt	2016-09-10 21:27:26.287380269 +0200
@@ -155,7 +155,7 @@
 	${HUPNP_INCLUDE_DIR}
 	${QUAZIP_INCLUDE_DIRECTORY}
 	# ${ZLIB_INCLUDE_DIRS}
-	${CMAKE_CURRENT_SOURCE_DIR}/3rdparty/libqpsd
+	${LIBQPSD_INCLUDE_DIRECTORY}
 )
 
 if (APPLE) # todo: somehow add this to Mac.cmake or MacBuildTarget.cmake
--- nomacs-3.4.1/cmake/UnixBuildTarget.cmake.orig	2016-07-28 11:01:01.000000000 +0200
+++ nomacs-3.4.1/cmake/UnixBuildTarget.cmake	2016-09-10 22:09:29.120684793 +0200
@@ -14,7 +14,7 @@
 #binary
 link_directories(${LIBRAW_LIBRARY_DIRS} ${OpenCV_LIBRARY_DIRS} ${EXIV2_LIBRARY_DIRS} ${CMAKE_BINARY_DIR})
 add_executable(${BINARY_NAME} WIN32  MACOSX_BUNDLE ${NOMACS_EXE_SOURCES} ${NOMACS_EXE_HEADERS} ${NOMACS_QM} ${NOMACS_TRANSLATIONS} ${NOMACS_RC} ${QUAZIP_SOURCES})
-target_link_libraries(${BINARY_NAME} ${DLL_NAME} ${DLL_CORE_NAME} ${DLL_LOADER_NAME} ${EXIV2_LIBRARIES} ${LIBRAW_LIBRARIES} ${OpenCV_LIBS} ${VERSION_LIB} ${TIFF_LIBRARIES} ${HUPNP_LIBS} ${HUPNPAV_LIBS} ${QUAZIP_LIBRARIES} ${ZLIB_LIBRARY} ${LIBQPSD_LIBRARY})
+target_link_libraries(${BINARY_NAME} ${DLL_NAME} ${DLL_CORE_NAME} ${DLL_LOADER_NAME} ${EXIV2_LIBRARIES} ${LIBRAW_LIBRARIES} ${OpenCV_LIBS} ${VERSION_LIB} ${TIFF_LIBRARIES} ${HUPNP_LIBS} ${HUPNPAV_LIBS} ${QUAZIP_LIBRARIES} ${ZLIB_LIBRARY})
 
 
 set_target_properties(${BINARY_NAME} PROPERTIES COMPILE_FLAGS "-DDK_DLL_IMPORT -DNOMINMAX")
@@ -28,7 +28,7 @@
 
 # add loader
 add_library(${DLL_LOADER_NAME} SHARED ${LOADER_SOURCES} ${NOMACS_UI} ${NOMACS_RCC} ${LOADER_HEADERS} ${AUTOFLOW_RC} ${QUAZIP_SOURCES} ${LIBQPSD_SOURCES} ${LIBQPSD_HEADERS})
-target_link_libraries(${DLL_LOADER_NAME} ${DLL_CORE_NAME} ${EXIV2_LIBRARIES} ${LIBRAW_LIBRARIES} ${OpenCV_LIBS} ${VERSION_LIB} ${TIFF_LIBRARIES} ${HUPNP_LIBS} ${HUPNPAV_LIBS} ${QUAZIP_LIBRARIES})
+target_link_libraries(${DLL_LOADER_NAME} ${DLL_CORE_NAME} ${EXIV2_LIBRARIES} ${LIBRAW_LIBRARIES} ${OpenCV_LIBS} ${VERSION_LIB} ${TIFF_LIBRARIES} ${HUPNP_LIBS} ${HUPNPAV_LIBS} ${QUAZIP_LIBRARIES} ${LIBQPSD_LIBRARY})
 set_property(TARGET ${DLL_LOADER_NAME} PROPERTY VERSION ${NOMACS_VERSION_MAJOR}.${NOMACS_VERSION_MINOR}.${NOMACS_VERSION_PATCH})
 set_property(TARGET ${DLL_LOADER_NAME} PROPERTY SOVERSION ${NOMACS_VERSION_MAJOR})
 
